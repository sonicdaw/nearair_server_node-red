[{"id":"64e7c9c1.274918","type":"milkcocoa out","z":"e5c5131b.4732","milkcocoa":"34fca911.419816","dataStore":"nearair","operation":"push","targetId":"nearair","name":"nearair db","x":1022.5,"y":318.5714111328125,"wires":[["fc102995.31e978"]]},{"id":"b5e3735b.8cee5","type":"twitter in","z":"e5c5131b.4732","twitter":"","tags":".","user":"false","name":"","topic":"tweets","inputs":0,"x":76,"y":225.2381134033203,"wires":[["72ec2e19.d09fa"]]},{"id":"72ec2e19.d09fa","type":"switch","z":"e5c5131b.4732","name":"location!=null","property":"location","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":220,"y":225.2381134033203,"wires":[["c6823811.430598"],["53c3d4d2.1f140c"]]},{"id":"c6823811.430598","type":"switch","z":"e5c5131b.4732","name":"location.lat!=null","property":"location.lat","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":395,"y":221.2381134033203,"wires":[["e52dbaf0.4276f8"],["53c3d4d2.1f140c"]]},{"id":"e52dbaf0.4276f8","type":"switch","z":"e5c5131b.4732","name":"location.lon!=null","property":"location.lon","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":586,"y":219.2381134033203,"wires":[["ec284bea.637708","5773ffa5.2a98b"],["53c3d4d2.1f140c"]]},{"id":"ec284bea.637708","type":"template","z":"e5c5131b.4732","name":"Move/Zoom","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"command\":{\n        \"layer\":\"Esri Terrain\",\n        \"lat\":\"{{location.lat}}\",\n        \"lon\":\"{{location.lon}}\",\n        \"zoom\":\"3\"\n        }\n}","x":858,"y":233.2381134033203,"wires":[[]]},{"id":"5773ffa5.2a98b","type":"template","z":"e5c5131b.4732","name":"Set PIN","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\"lat\": \"{{location.lat}}\",\n\"lon\": \"{{location.lon}}\",\n\"place\":\"{{location.place}}\",\n\"tweet\":\"{{payload}}\",\n\"name\":\"{{tweet.user.name}}\",\n\"icon\":\"globe\",\n\"iconColor\":\"orange\"\n}","x":848,"y":274.2381134033203,"wires":[["14ac7554.21ba0b","64e7c9c1.274918"]]},{"id":"14ac7554.21ba0b","type":"worldmap","z":"e5c5131b.4732","name":"","lat":"","lon":"","zoom":"","layer":"OSM grey","cluster":"","maxage":"999","usermenu":"show","layers":"show","panit":"false","x":1054,"y":397.2381134033203,"wires":[]},{"id":"53c3d4d2.1f140c","type":"function","z":"e5c5131b.4732","name":"Detect Location Word","func":"var array = [];\nvar word_data = global.get(\"words\");\n\nfor (var i=0; i<word_data.words.length;i++) {\n    if(msg.payload.match(word_data.words[i].word)){ \n        msg.location.lat = word_data.words[i].lat;\n        msg.location.lon = word_data.words[i].lon;\n        msg.payload = \"[\" + word_data.words[i].word + \"] \" + msg.payload;\n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":628,"y":344.2381134033203,"wires":[["ec284bea.637708","5773ffa5.2a98b"]]},{"id":"46049836.611a18","type":"inject","z":"e5c5131b.4732","name":"Periodical update","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 00 * * *","once":false,"x":134.83334350585938,"y":106,"wires":[["c3c07fa8.2e2ff"]]},{"id":"c3c07fa8.2e2ff","type":"http request","z":"e5c5131b.4732","name":"Get data","method":"GET","ret":"txt","url":"http://nearair.net/word/json.php","tls":"","x":362.8333435058594,"y":106,"wires":[["8367060a.520228"]]},{"id":"8367060a.520228","type":"json","z":"e5c5131b.4732","name":"Parse Data","x":524.3333435058594,"y":106,"wires":[["62ae98d0.da00c8"]]},{"id":"62ae98d0.da00c8","type":"function","z":"e5c5131b.4732","name":"Set Location Word","func":"global.set(\"words\", msg.payload);\n\nreturn msg.payload;","outputs":1,"noerr":0,"x":720.3333435058594,"y":106,"wires":[[]]},{"id":"97322574.16cc28","type":"comment","z":"e5c5131b.4732","name":"No Location Data","info":"","x":602,"y":308.2381134033203,"wires":[]},{"id":"d337d339.f627a","type":"inject","z":"e5c5131b.4732","name":"Get Location Word Data","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":153.83334350585938,"y":52,"wires":[["c3c07fa8.2e2ff"]]},{"id":"f2856d88.9eadc","type":"mqtt in","z":"e5c5131b.4732","name":"GPS MQTT device(owntracks)","topic":"owntracks/nhljjada/mqtt","qos":"2","broker":"45d1dfd4.868c6","x":145.71426391601562,"y":454.2381210923195,"wires":[["dfcd8277.c82f3"]]},{"id":"dfcd8277.c82f3","type":"json","z":"e5c5131b.4732","name":"","x":352.99999809265137,"y":454.2381301522255,"wires":[["70ccb502.b39d3c","15552106.73043f"]]},{"id":"70ccb502.b39d3c","type":"template","z":"e5c5131b.4732","name":"Set PIN","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\"lat\": \"{{payload.lat}}\",\n\"lon\": \"{{payload.lon}}\",\n\"place\":\"\",\n\"tweet\":\"\",\n\"name\":\"\",\n\"icon\":\"globe\",\n\"iconColor\":\"red\"\n}","x":845.9999732971191,"y":446.57143783569336,"wires":[["14ac7554.21ba0b"]]},{"id":"15552106.73043f","type":"template","z":"e5c5131b.4732","name":"Move/Zoom","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"command\":{\n        \"layer\":\"Esri Terrain\",\n        \"lat\":\"{{payload.lat}}\",\n        \"lon\":\"{{payload.lon}}\",\n        \"zoom\":\"12\"\n        }\n}","x":856.6666564941406,"y":396.90478897094727,"wires":[["14ac7554.21ba0b"]]},{"id":"fc102995.31e978","type":"debug","z":"e5c5131b.4732","name":"","active":true,"console":"false","complete":"false","x":1175.5,"y":319,"wires":[]},{"id":"34fca911.419816","type":"milkcocoa","z":"","appId":"applejd77vii5"},{"id":"45d1dfd4.868c6","type":"mqtt-broker","z":"","broker":"m14.cloudmqtt.com","port":"19917","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""}]