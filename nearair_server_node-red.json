[{"id":"7e9a55fa.beeddc","type":"twitter in","z":"4be58dc.3009b74","twitter":"","tags":".","user":"false","name":"","topic":"tweets","inputs":0,"x":116,"y":88,"wires":[["97879247.7246b"]]},{"id":"97879247.7246b","type":"switch","z":"4be58dc.3009b74","name":"location!=null","property":"location","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":260,"y":88,"wires":[["68b3e935.57c9b8"],["2aa59dc2.ec1a12"]]},{"id":"68b3e935.57c9b8","type":"switch","z":"4be58dc.3009b74","name":"location.lat!=null","property":"location.lat","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":435,"y":84,"wires":[["ffe8cca6.3b86c"],["2aa59dc2.ec1a12"]]},{"id":"ffe8cca6.3b86c","type":"switch","z":"4be58dc.3009b74","name":"location.lon!=null","property":"location.lon","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":626,"y":82,"wires":[["64b95c5f.c578a4","75cfc61d.4d35b8"],["2aa59dc2.ec1a12"]]},{"id":"64b95c5f.c578a4","type":"template","z":"4be58dc.3009b74","name":"Move/Zoom","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"command\":{\n        \"layer\":\"Esri Terrain\",\n        \"lat\":\"{{location.lat}}\",\n        \"lon\":\"{{location.lon}}\",\n        \"zoom\":\"3\"\n        }\n}","output":"json","x":898,"y":96,"wires":[["81936d2a.ae3ae"]]},{"id":"75cfc61d.4d35b8","type":"template","z":"4be58dc.3009b74","name":"Set PIN","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\"lat\": \"{{location.lat}}\",\n\"lon\": \"{{location.lon}}\",\n\"place\":\"{{location.place}}\",\n\"tweet\":\"{{payload}}\",\n\"name\":\"{{tweet.user.name}}\",\n\"icon\":\"globe\",\n\"iconColor\":\"orange\"\n}","output":"json","x":888,"y":137,"wires":[["81936d2a.ae3ae"]]},{"id":"81936d2a.ae3ae","type":"worldmap","z":"4be58dc.3009b74","name":"","lat":"","lon":"","zoom":"","layer":"OSM grey","cluster":"","maxage":"999","usermenu":"show","layers":"show","panit":"false","x":1084,"y":113,"wires":[]},{"id":"2aa59dc2.ec1a12","type":"function","z":"4be58dc.3009b74","name":"Detect Location Word","func":"var array = [];\nvar word_data = global.get(\"words\");\n\nfor (var i=0; i<word_data.words.length;i++) {\n    if(msg.payload.match(word_data.words[i].word)){ \n        msg.location.lat = word_data.words[i].lat;\n        msg.location.lon = word_data.words[i].lon;\n        msg.payload = \"[\" + word_data.words[i].word + \"] \" + msg.payload;\n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":668,"y":207,"wires":[["64b95c5f.c578a4","75cfc61d.4d35b8"]]},{"id":"f7c78d5c.69d07","type":"inject","z":"4be58dc.3009b74","name":"Periodical update","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 00 * * *","once":false,"x":176.5,"y":324,"wires":[["5de3071.7732bf8"]]},{"id":"5de3071.7732bf8","type":"http request","z":"4be58dc.3009b74","name":"Get data","method":"GET","ret":"txt","url":"http://nearair.net/word/json.php","tls":"","x":404.5,"y":324,"wires":[["f76db654.a83b28"]]},{"id":"f76db654.a83b28","type":"json","z":"4be58dc.3009b74","name":"Parse Data","pretty":false,"x":566,"y":324,"wires":[["460e19be.ef1928"]]},{"id":"460e19be.ef1928","type":"function","z":"4be58dc.3009b74","name":"Set Location Word","func":"global.set(\"words\", msg.payload);\n\nreturn msg.payload;","outputs":1,"noerr":0,"x":762,"y":324,"wires":[[]]},{"id":"e8c7fffe.57f8a","type":"comment","z":"4be58dc.3009b74","name":"No Location Data","info":"","x":642,"y":171,"wires":[]},{"id":"bce4080d.715dd8","type":"inject","z":"4be58dc.3009b74","name":"Get Location Word Data","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":195.5,"y":270,"wires":[["5de3071.7732bf8"]]}]