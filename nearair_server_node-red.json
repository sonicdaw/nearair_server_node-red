[{"id":"591e3261.e1794c","type":"twitter in","z":"89688fa1.77a51","twitter":"","tags":".","user":"false","name":"","topic":"tweets","inputs":0,"x":78.90480041503906,"y":219.61902046203613,"wires":[["bdf71f46.b425b"]]},{"id":"bdf71f46.b425b","type":"switch","z":"89688fa1.77a51","name":"location!=null","property":"location","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":222.90480041503906,"y":219.61902046203613,"wires":[["b9805af.227c2a8"],["14b56ce6.507f03"]]},{"id":"b9805af.227c2a8","type":"switch","z":"89688fa1.77a51","name":"location.lat!=null","property":"location.lat","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":397.90480041503906,"y":215.61902046203613,"wires":[["1b3fc06a.ddc31"],["14b56ce6.507f03"]]},{"id":"1b3fc06a.ddc31","type":"switch","z":"89688fa1.77a51","name":"location.lon!=null","property":"location.lon","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":588.9048004150391,"y":213.61902046203613,"wires":[["14d18c01.bbad64","f4f37e48.3b838"],["14b56ce6.507f03"]]},{"id":"14d18c01.bbad64","type":"template","z":"89688fa1.77a51","name":"Move/Zoom","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"command\":{\n        \"layer\":\"Esri Terrain\",\n        \"lat\":\"{{location.lat}}\",\n        \"lon\":\"{{location.lon}}\",\n        \"zoom\":\"3\"\n        }\n}","output":"json","x":860.9048004150391,"y":227.61902046203613,"wires":[[]]},{"id":"f4f37e48.3b838","type":"template","z":"89688fa1.77a51","name":"Set PIN","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\"lat\": \"{{location.lat}}\",\n\"lon\": \"{{location.lon}}\",\n\"place\":\"{{location.place}}\",\n\"tweet\":\"{{payload}}\",\n\"name\":\"{{tweet.user.name}}\",\n\"icon\":\"globe\",\n\"iconColor\":\"orange\"\n}","output":"json","x":850.9048004150391,"y":268.61902046203613,"wires":[["d61498d1.3d7378"]]},{"id":"d61498d1.3d7378","type":"worldmap","z":"89688fa1.77a51","name":"","lat":"","lon":"","zoom":"","layer":"OSM grey","cluster":"","maxage":"999","usermenu":"show","layers":"show","panit":"false","x":1046.904800415039,"y":244.61902046203613,"wires":[]},{"id":"14b56ce6.507f03","type":"function","z":"89688fa1.77a51","name":"Detect Location Word","func":"var array = [];\nvar word_data = global.get(\"words\");\n\nfor (var i=0; i<word_data.words.length;i++) {\n    if(msg.payload.match(word_data.words[i].word)){ \n        msg.location.lat = word_data.words[i].lat;\n        msg.location.lon = word_data.words[i].lon;\n        msg.payload = \"[\" + word_data.words[i].word + \"] \" + msg.payload;\n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":630.9048004150391,"y":338.61902046203613,"wires":[["14d18c01.bbad64","f4f37e48.3b838"]]},{"id":"112a90a3.d44d6f","type":"inject","z":"89688fa1.77a51","name":"Periodical update","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 00 * * *","once":false,"x":137.73814392089844,"y":100.38090705871582,"wires":[["c9053ca6.ae7dd"]]},{"id":"c9053ca6.ae7dd","type":"http request","z":"89688fa1.77a51","name":"Get data","method":"GET","ret":"txt","url":"http://nearair.net/word/json.php","tls":"","x":365.73814392089844,"y":100.38090705871582,"wires":[["9671ce3e.3253"]]},{"id":"9671ce3e.3253","type":"json","z":"89688fa1.77a51","name":"Parse Data","pretty":false,"x":527.2381439208984,"y":100.38090705871582,"wires":[["34314290.2f1dbe"]]},{"id":"34314290.2f1dbe","type":"function","z":"89688fa1.77a51","name":"Set Location Word","func":"global.set(\"words\", msg.payload);\n\nreturn msg.payload;","outputs":1,"noerr":0,"x":723.2381439208984,"y":100.38090705871582,"wires":[[]]},{"id":"f0542867.7e5438","type":"comment","z":"89688fa1.77a51","name":"No Location Data","info":"","x":604.9048004150391,"y":302.61902046203613,"wires":[]},{"id":"e6a8e464.a93628","type":"inject","z":"89688fa1.77a51","name":"Get Location Word Data","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":156.73814392089844,"y":46.38090705871582,"wires":[["c9053ca6.ae7dd"]]},{"id":"804828e3.8f9e78","type":"mqtt in","z":"89688fa1.77a51","name":"GPS MQTT device(owntracks)","topic":"owntracks/nhljjada/mqtt","qos":"2","broker":"70838831.810af8","x":148.6190643310547,"y":448.6190281510353,"wires":[["379b6cf6.601774"]]},{"id":"379b6cf6.601774","type":"json","z":"89688fa1.77a51","name":"","pretty":false,"x":355.90479850769043,"y":448.6190372109413,"wires":[["6001e060.6a9f7","b9342965.3df2c8"]]},{"id":"6001e060.6a9f7","type":"template","z":"89688fa1.77a51","name":"Set PIN","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\"lat\": \"{{payload.lat}}\",\n\"lon\": \"{{payload.lon}}\",\n\"place\":\"\",\n\"tweet\":\"\",\n\"name\":\"\",\n\"icon\":\"globe\",\n\"iconColor\":\"red\"\n}","output":"json","x":848.9047737121582,"y":440.9523448944092,"wires":[["d61498d1.3d7378"]]},{"id":"b9342965.3df2c8","type":"template","z":"89688fa1.77a51","name":"Move/Zoom","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"command\":{\n        \"layer\":\"Esri Terrain\",\n        \"lat\":\"{{payload.lat}}\",\n        \"lon\":\"{{payload.lon}}\",\n        \"zoom\":\"12\"\n        }\n}","output":"json","x":859.5714569091797,"y":391.2856960296631,"wires":[["d61498d1.3d7378"]]},{"id":"70838831.810af8","type":"mqtt-broker","z":"","broker":"m14.cloudmqtt.com","port":"19917","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""}]