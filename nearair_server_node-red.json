[{"id":"9597d7c4.73a838","type":"slack","z":"24c053f6.da168c","name":"nearair notification","channelURL":"","username":"nearair","emojiIcon":"","channel":"","x":1274,"y":547,"wires":[]},{"id":"f8f7aca6.1c00d","type":"switch","z":"24c053f6.da168c","name":"location!=null","property":"location","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":210.5,"y":219.2381134033203,"wires":[["86cf5fc6.e26ae"],["b0791135.3bc2c"]]},{"id":"86cf5fc6.e26ae","type":"switch","z":"24c053f6.da168c","name":"location.lat!=null","property":"location.lat","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":399.5,"y":208.2381134033203,"wires":[["47cab088.a2421"],["b0791135.3bc2c"]]},{"id":"47cab088.a2421","type":"switch","z":"24c053f6.da168c","name":"location.lon!=null","property":"location.lon","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":607.5,"y":202.2381134033203,"wires":[["b74d423b.31945","7f062e22.aa77f","a6c43410.287828"],["b0791135.3bc2c"]]},{"id":"b74d423b.31945","type":"template","z":"24c053f6.da168c","name":"Move/Zoom","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"command\":{\n        \"layer\":\"Esri Terrain\",\n        \"lat\":\"{{location.lat}}\",\n        \"lon\":\"{{location.lon}}\",\n        \"zoom\":\"3\"\n        }\n}","x":848.5,"y":227.2381134033203,"wires":[[]]},{"id":"7f062e22.aa77f","type":"template","z":"24c053f6.da168c","name":"Set PIN","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\"lat\": \"{{location.lat}}\",\n\"lon\": \"{{location.lon}}\",\n\"place\":\"{{location.place}}\",\n\"tweet\":\"{{payload}}\",\n\"name\":\"{{tweet.user.name}}\",\n\"icon\":\"globe\",\n\"iconColor\":\"orange\"\n}","x":838.5,"y":268.2381134033203,"wires":[["b47cac1c.c7744"]]},{"id":"b47cac1c.c7744","type":"worldmap","z":"24c053f6.da168c","name":"","lat":"","lon":"","zoom":"","layer":"OSM grey","cluster":"","maxage":"999","usermenu":"show","layers":"show","panit":"false","x":1044.5,"y":391.2381134033203,"wires":[]},{"id":"b0791135.3bc2c","type":"function","z":"24c053f6.da168c","name":"Detect Location Word","func":"var array = [];\nvar word_data = global.get(\"words\");\n\nfor (var i=0; i<word_data.words.length;i++) {\n    if(msg.payload.match(word_data.words[i].word)){ \n        msg.location.lat = word_data.words[i].lat;\n        msg.location.lon = word_data.words[i].lon;\n        msg.payload = \"[\" + word_data.words[i].word + \"] \" + msg.payload;\n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":618.5,"y":338.2381134033203,"wires":[["b74d423b.31945","7f062e22.aa77f","a6c43410.287828"]]},{"id":"368bc882.d3d8a8","type":"inject","z":"24c053f6.da168c","name":"Periodical update","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 00 * * *","once":false,"x":125.33334350585938,"y":100,"wires":[["8a610b8b.534f28"]]},{"id":"8a610b8b.534f28","type":"http request","z":"24c053f6.da168c","name":"Get data","method":"GET","ret":"txt","url":"http://nearair.net/word/json.php","tls":"","x":353.3333435058594,"y":100,"wires":[["7fc1bd24.432174"]]},{"id":"7fc1bd24.432174","type":"json","z":"24c053f6.da168c","name":"Parse Data","x":514.8333435058594,"y":100,"wires":[["9badeeaf.78efb"]]},{"id":"9badeeaf.78efb","type":"function","z":"24c053f6.da168c","name":"Set Location Word","func":"global.set(\"words\", msg.payload);\n\nreturn msg.payload;","outputs":1,"noerr":0,"x":710.8333435058594,"y":100,"wires":[[]]},{"id":"5b22958e.79671c","type":"comment","z":"24c053f6.da168c","name":"No Location Data","info":"","x":592.5,"y":302.2381134033203,"wires":[]},{"id":"d5eece37.0a117","type":"inject","z":"24c053f6.da168c","name":"Get Location Word Data","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":144.33334350585938,"y":46,"wires":[["8a610b8b.534f28"]]},{"id":"12f31f2a.fd42d1","type":"mqtt in","z":"24c053f6.da168c","name":"GPS MQTT device(owntracks)","topic":"owntracks/nhljjada/mqtt","qos":"2","broker":"8dc00472.5fe048","x":144.21426391601562,"y":467.2381210923195,"wires":[["54f61830.1d0048"]]},{"id":"54f61830.1d0048","type":"json","z":"24c053f6.da168c","name":"","x":351.49999809265137,"y":467.2381301522255,"wires":[["86d31a8d.bc98b8","a2f386b.ac8a178"]]},{"id":"86d31a8d.bc98b8","type":"template","z":"24c053f6.da168c","name":"Set PIN","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\"lat\": \"{{payload.lat}}\",\n\"lon\": \"{{payload.lon}}\",\n\"place\":\"\",\n\"tweet\":\"\",\n\"name\":\"\",\n\"icon\":\"globe\",\n\"iconColor\":\"red\"\n}","x":829.5,"y":484.5714416503906,"wires":[["b47cac1c.c7744"]]},{"id":"a2f386b.ac8a178","type":"template","z":"24c053f6.da168c","name":"Move/Zoom","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"command\":{\n        \"layer\":\"Esri Terrain\",\n        \"lat\":\"{{payload.lat}}\",\n        \"lon\":\"{{payload.lon}}\",\n        \"zoom\":\"12\"\n        }\n}","x":842.1666870117188,"y":431.90478515625,"wires":[["b47cac1c.c7744"]]},{"id":"73d6aadd.020a74","type":"sqlite","z":"24c053f6.da168c","mydb":"4a041bf6.b83ee4","name":"NearAir sqlite DB","x":1068,"y":313,"wires":[["9e45d308.a5c13"]]},{"id":"26215e88.003492","type":"inject","z":"24c053f6.da168c","name":"Create DB","topic":"CREATE TABLE nearair (latitude REAL, longitude REAL, place TEXT, text TEXT);","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1049.5,"y":208,"wires":[["73d6aadd.020a74"]]},{"id":"a6c43410.287828","type":"template","z":"24c053f6.da168c","name":"Insert","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO nearair VALUES ('{{location.lat}}', '{{location.lon}}', '{{location.place}}', '{{payload}}');","output":"str","x":828,"y":313,"wires":[["73d6aadd.020a74"]]},{"id":"c1457a88.606a88","type":"inject","z":"24c053f6.da168c","name":"Select All","topic":"SELECT * FROM nearair;","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1049,"y":250,"wires":[["73d6aadd.020a74"]]},{"id":"9e45d308.a5c13","type":"debug","z":"24c053f6.da168c","name":"","active":true,"console":"false","complete":"false","x":1261,"y":313,"wires":[]},{"id":"cb41502c.a34b1","type":"twitter in","z":"24c053f6.da168c","twitter":"","tags":".","user":"false","name":"","topic":"tweets","inputs":0,"x":65,"y":219,"wires":[["f8f7aca6.1c00d"]]},{"id":"627091a.e3e957","type":"sqlite","z":"24c053f6.da168c","mydb":"4a041bf6.b83ee4","name":"NearAir sqlite DB","x":1060,"y":548,"wires":[["9597d7c4.73a838"]]},{"id":"bc8a25aa.cdfc78","type":"template","z":"24c053f6.da168c","name":"Detect NearAir","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"","output":"str","x":850,"y":549,"wires":[["627091a.e3e957"]]},{"id":"8dc00472.5fe048","type":"mqtt-broker","z":"","broker":"m14.cloudmqtt.com","port":"19917","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""},{"id":"4a041bf6.b83ee4","type":"sqlitedb","z":"","db":"/Users/user/db/nearair.db"}]