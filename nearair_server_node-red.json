[{"id":"c0f04de5.ce61c","type":"slack","z":"69b19ff5.1524b","name":"nearair notification","channelURL":"","username":"nearair","emojiIcon":"","channel":"","x":1115.5,"y":571,"wires":[]},{"id":"5869e2be.005fbc","type":"milkcocoa out","z":"69b19ff5.1524b","milkcocoa":"3caf9bbb.631d14","dataStore":"nearair","operation":"push","targetId":"nearair","name":"nearair db","x":1037.5,"y":328.5714111328125,"wires":[["43e70342.3ecc2c"]]},{"id":"51bc7151.71f38","type":"twitter in","z":"69b19ff5.1524b","twitter":"","tags":".","user":"false","name":"","topic":"tweets","inputs":0,"x":91,"y":235.2381134033203,"wires":[["5f71aef2.ee34b"]]},{"id":"5f71aef2.ee34b","type":"switch","z":"69b19ff5.1524b","name":"location!=null","property":"location","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":235,"y":235.2381134033203,"wires":[["c6e67e88.fc8be"],["1271a641.cf351a"]]},{"id":"c6e67e88.fc8be","type":"switch","z":"69b19ff5.1524b","name":"location.lat!=null","property":"location.lat","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":424,"y":224.2381134033203,"wires":[["2ffa5992.b999d6"],["1271a641.cf351a"]]},{"id":"2ffa5992.b999d6","type":"switch","z":"69b19ff5.1524b","name":"location.lon!=null","property":"location.lon","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":632,"y":218.2381134033203,"wires":[["837f6359.6cad6","c008b720.b18478"],["1271a641.cf351a"]]},{"id":"837f6359.6cad6","type":"template","z":"69b19ff5.1524b","name":"Move/Zoom","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"command\":{\n        \"layer\":\"Esri Terrain\",\n        \"lat\":\"{{location.lat}}\",\n        \"lon\":\"{{location.lon}}\",\n        \"zoom\":\"3\"\n        }\n}","x":873,"y":243.2381134033203,"wires":[[]]},{"id":"c008b720.b18478","type":"template","z":"69b19ff5.1524b","name":"Set PIN","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\"lat\": \"{{location.lat}}\",\n\"lon\": \"{{location.lon}}\",\n\"place\":\"{{location.place}}\",\n\"tweet\":\"{{payload}}\",\n\"name\":\"{{tweet.user.name}}\",\n\"icon\":\"globe\",\n\"iconColor\":\"orange\"\n}","x":863,"y":284.2381134033203,"wires":[["2b9e491d.c3faa6","5869e2be.005fbc"]]},{"id":"2b9e491d.c3faa6","type":"worldmap","z":"69b19ff5.1524b","name":"","lat":"","lon":"","zoom":"","layer":"OSM grey","cluster":"","maxage":"999","usermenu":"show","layers":"show","panit":"false","x":1069,"y":407.2381134033203,"wires":[]},{"id":"1271a641.cf351a","type":"function","z":"69b19ff5.1524b","name":"Detect Location Word","func":"var array = [];\nvar word_data = global.get(\"words\");\n\nfor (var i=0; i<word_data.words.length;i++) {\n    if(msg.payload.match(word_data.words[i].word)){ \n        msg.location.lat = word_data.words[i].lat;\n        msg.location.lon = word_data.words[i].lon;\n        msg.payload = \"[\" + word_data.words[i].word + \"] \" + msg.payload;\n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":643,"y":354.2381134033203,"wires":[["837f6359.6cad6","c008b720.b18478"]]},{"id":"72ace521.54637c","type":"inject","z":"69b19ff5.1524b","name":"Periodical update","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 00 * * *","once":false,"x":149.83334350585938,"y":116,"wires":[["ebe1191c.562588"]]},{"id":"ebe1191c.562588","type":"http request","z":"69b19ff5.1524b","name":"Get data","method":"GET","ret":"txt","url":"http://nearair.net/word/json.php","tls":"","x":377.8333435058594,"y":116,"wires":[["70be37d8.5d9618"]]},{"id":"70be37d8.5d9618","type":"json","z":"69b19ff5.1524b","name":"Parse Data","x":539.3333435058594,"y":116,"wires":[["da142ad1.a7dd18"]]},{"id":"da142ad1.a7dd18","type":"function","z":"69b19ff5.1524b","name":"Set Location Word","func":"global.set(\"words\", msg.payload);\n\nreturn msg.payload;","outputs":1,"noerr":0,"x":735.3333435058594,"y":116,"wires":[[]]},{"id":"5c3ef3b1.0080fc","type":"comment","z":"69b19ff5.1524b","name":"No Location Data","info":"","x":617,"y":318.2381134033203,"wires":[]},{"id":"72e6cd97.97b524","type":"inject","z":"69b19ff5.1524b","name":"Get Location Word Data","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":168.83334350585938,"y":62,"wires":[["ebe1191c.562588"]]},{"id":"8363d6dc.826178","type":"mqtt in","z":"69b19ff5.1524b","name":"GPS MQTT device(owntracks)","topic":"owntracks/nhljjada/mqtt","qos":"2","broker":"31f1d110.56144e","x":168.71426391601562,"y":483.2381210923195,"wires":[["5cd9c565.75985c"]]},{"id":"5cd9c565.75985c","type":"json","z":"69b19ff5.1524b","name":"","x":375.99999809265137,"y":483.2381301522255,"wires":[["97b8bd8a.e36df","79515182.190f9"]]},{"id":"97b8bd8a.e36df","type":"template","z":"69b19ff5.1524b","name":"Set PIN","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\"lat\": \"{{payload.lat}}\",\n\"lon\": \"{{payload.lon}}\",\n\"place\":\"\",\n\"tweet\":\"\",\n\"name\":\"\",\n\"icon\":\"globe\",\n\"iconColor\":\"red\"\n}","x":604,"y":502.5714416503906,"wires":[["2b9e491d.c3faa6"]]},{"id":"79515182.190f9","type":"template","z":"69b19ff5.1524b","name":"Move/Zoom","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"command\":{\n        \"layer\":\"Esri Terrain\",\n        \"lat\":\"{{payload.lat}}\",\n        \"lon\":\"{{payload.lon}}\",\n        \"zoom\":\"12\"\n        }\n}","x":611.6666870117188,"y":448.90478515625,"wires":[["2b9e491d.c3faa6"]]},{"id":"43e70342.3ecc2c","type":"debug","z":"69b19ff5.1524b","name":"","active":true,"console":"false","complete":"false","x":1190.5,"y":329,"wires":[]},{"id":"df6cb39d.bdb1","type":"function","z":"69b19ff5.1524b","name":"Detect Nearair","func":"\nreturn msg;","outputs":1,"noerr":0,"x":924.5,"y":571,"wires":[["c0f04de5.ce61c"]]},{"id":"3caf9bbb.631d14","type":"milkcocoa","z":"","appId":"applejd77vii5"},{"id":"31f1d110.56144e","type":"mqtt-broker","z":"","broker":"m14.cloudmqtt.com","port":"19917","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""}]