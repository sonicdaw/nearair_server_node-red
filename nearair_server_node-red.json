[
    {
        "id": "dc355fae.20a4b",
        "type": "slack",
        "z": "50a8b9e3.df0248",
        "name": "nearair notification",
        "channelURL": "",
        "username": "nearair",
        "emojiIcon": "",
        "channel": "",
        "x": 1250,
        "y": 540,
        "wires": []
    },
    {
        "id": "c5af1501.6f5e78",
        "type": "switch",
        "z": "50a8b9e3.df0248",
        "name": "location!=null",
        "property": "location",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 196.5,
        "y": 211.2381134033203,
        "wires": [
            [
                "c9d58d3b.45c52"
            ],
            [
                "7fbdfa69.f33274"
            ]
        ]
    },
    {
        "id": "c9d58d3b.45c52",
        "type": "switch",
        "z": "50a8b9e3.df0248",
        "name": "location.lat!=null",
        "property": "location.lat",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 385.5,
        "y": 200.2381134033203,
        "wires": [
            [
                "92ba9511.6a4fb8"
            ],
            [
                "7fbdfa69.f33274"
            ]
        ]
    },
    {
        "id": "92ba9511.6a4fb8",
        "type": "switch",
        "z": "50a8b9e3.df0248",
        "name": "location.lon!=null",
        "property": "location.lon",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 593.5,
        "y": 194.2381134033203,
        "wires": [
            [
                "d5c796f2.23a2a8",
                "ba3b9c9b.1ef21",
                "4cf835ef.66817c"
            ],
            [
                "7fbdfa69.f33274"
            ]
        ]
    },
    {
        "id": "8055c776.193948",
        "type": "worldmap",
        "z": "50a8b9e3.df0248",
        "name": "",
        "lat": "",
        "lon": "",
        "zoom": "",
        "layer": "OSM grey",
        "cluster": "",
        "maxage": "999",
        "usermenu": "show",
        "layers": "show",
        "panit": "false",
        "x": 1030.5,
        "y": 383.2381134033203,
        "wires": []
    },
    {
        "id": "7fbdfa69.f33274",
        "type": "function",
        "z": "50a8b9e3.df0248",
        "name": "Detect Location Word",
        "func": "var array = [];\nvar word_data = global.get(\"words\");\n\nfor (var i=0; i<word_data.words.length;i++) {\n    if(msg.payload.match(word_data.words[i].word)){\n        var locationObject = {\n            lat: word_data.words[i].lat,\n            lon: word_data.words[i].lon\n        };\n        msg.location = locationObject;\n        msg.payload = \"[\" + word_data.words[i].word + \"] \" + msg.payload;\n        return msg;\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 604.5,
        "y": 330.2381134033203,
        "wires": [
            [
                "d5c796f2.23a2a8",
                "ba3b9c9b.1ef21",
                "4cf835ef.66817c"
            ]
        ]
    },
    {
        "id": "4c14a961.2bac08",
        "type": "inject",
        "z": "50a8b9e3.df0248",
        "name": "Periodical update",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "00 00 * * *",
        "once": false,
        "x": 111.33334350585938,
        "y": 92,
        "wires": [
            [
                "43771eda.6cead"
            ]
        ]
    },
    {
        "id": "43771eda.6cead",
        "type": "http request",
        "z": "50a8b9e3.df0248",
        "name": "Get data",
        "method": "GET",
        "ret": "txt",
        "url": "http://nearair.net/word/json.php",
        "tls": "",
        "x": 339.3333435058594,
        "y": 92,
        "wires": [
            [
                "b1557d7b.a04a8"
            ]
        ]
    },
    {
        "id": "b1557d7b.a04a8",
        "type": "json",
        "z": "50a8b9e3.df0248",
        "name": "Parse Data",
        "x": 500.8333435058594,
        "y": 92,
        "wires": [
            [
                "f7e6c40a.a732a8"
            ]
        ]
    },
    {
        "id": "f7e6c40a.a732a8",
        "type": "function",
        "z": "50a8b9e3.df0248",
        "name": "Set Location Word",
        "func": "global.set(\"words\", msg.payload);\n\nreturn msg.payload;",
        "outputs": 1,
        "noerr": 0,
        "x": 696.8333435058594,
        "y": 92,
        "wires": [
            []
        ]
    },
    {
        "id": "7f108a3e.006734",
        "type": "comment",
        "z": "50a8b9e3.df0248",
        "name": "No Location Data",
        "info": "",
        "x": 578.5,
        "y": 294.2381134033203,
        "wires": []
    },
    {
        "id": "eb205f36.e7178",
        "type": "inject",
        "z": "50a8b9e3.df0248",
        "name": "Get Location Word Data",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 130.33334350585938,
        "y": 38,
        "wires": [
            [
                "43771eda.6cead"
            ]
        ]
    },
    {
        "id": "ad73a68d.3bb498",
        "type": "mqtt in",
        "z": "50a8b9e3.df0248",
        "name": "GPS MQTT device(owntracks)",
        "topic": "owntracks/nhljjada/mqtt",
        "qos": "2",
        "broker": "e96958b.d05c4a8",
        "x": 130.21426391601562,
        "y": 459.2381210923195,
        "wires": [
            [
                "45a49cf4.fc02a4"
            ]
        ]
    },
    {
        "id": "45a49cf4.fc02a4",
        "type": "json",
        "z": "50a8b9e3.df0248",
        "name": "",
        "x": 337.49999809265137,
        "y": 459.2381301522255,
        "wires": [
            [
                "2c4e9ab2.2fe536",
                "b5a1db8.12e1728",
                "605a7884.d4e878"
            ]
        ]
    },
    {
        "id": "2c4e9ab2.2fe536",
        "type": "template",
        "z": "50a8b9e3.df0248",
        "name": "Set PIN",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{\n\"lat\": \"{{payload.lat}}\",\n\"lon\": \"{{payload.lon}}\",\n\"place\":\"\",\n\"tweet\":\"\",\n\"name\":\"\",\n\"icon\":\"globe\",\n\"iconColor\":\"red\"\n}",
        "x": 815.5,
        "y": 476.5714416503906,
        "wires": [
            [
                "8055c776.193948"
            ]
        ]
    },
    {
        "id": "b5a1db8.12e1728",
        "type": "template",
        "z": "50a8b9e3.df0248",
        "name": "Move/Zoom",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{\n    \"command\":{\n        \"layer\":\"Esri Terrain\",\n        \"lat\":\"{{payload.lat}}\",\n        \"lon\":\"{{payload.lon}}\",\n        \"zoom\":\"12\"\n        }\n}",
        "x": 828.1666870117188,
        "y": 423.90478515625,
        "wires": [
            [
                "8055c776.193948"
            ]
        ]
    },
    {
        "id": "629492ec.10fd3c",
        "type": "inject",
        "z": "50a8b9e3.df0248",
        "name": "Create DB",
        "topic": "CREATE TABLE nearair (latitude REAL, longitude REAL, place TEXT, text TEXT);",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 1035.5,
        "y": 200,
        "wires": [
            [
                "bff5d7ab.aa94c8"
            ]
        ]
    },
    {
        "id": "d5c796f2.23a2a8",
        "type": "template",
        "z": "50a8b9e3.df0248",
        "name": "Insert",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "INSERT INTO nearair VALUES ('{{location.lat}}', '{{location.lon}}', '{{location.place}}', '{{payload}}');",
        "output": "str",
        "x": 814,
        "y": 305,
        "wires": [
            [
                "bff5d7ab.aa94c8"
            ]
        ]
    },
    {
        "id": "f1f89b00.8f33b8",
        "type": "inject",
        "z": "50a8b9e3.df0248",
        "name": "Select All",
        "topic": "SELECT * FROM nearair;",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 1035,
        "y": 242,
        "wires": [
            [
                "bff5d7ab.aa94c8"
            ]
        ]
    },
    {
        "id": "8c1301e1.999fa",
        "type": "twitter in",
        "z": "50a8b9e3.df0248",
        "twitter": "",
        "tags": ".",
        "user": "false",
        "name": "",
        "topic": "tweets",
        "inputs": 0,
        "x": 51,
        "y": 211,
        "wires": [
            [
                "c5af1501.6f5e78"
            ]
        ]
    },
    {
        "id": "605a7884.d4e878",
        "type": "template",
        "z": "50a8b9e3.df0248",
        "name": "Detect NearAir",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "SELECT * FROM nearair WHERE latitude BETWEEN {{payload.lat}}-0.05 AND {{payload.lat}}+0.05 AND longitude BETWEEN {{payload.lon}}-0.05 AND {{payload.lon}}+0.05;",
        "output": "str",
        "x": 836,
        "y": 541,
        "wires": [
            [
                "bff5d7ab.aa94c8"
            ]
        ]
    },
    {
        "id": "bff5d7ab.aa94c8",
        "type": "sqlite",
        "z": "50a8b9e3.df0248",
        "mydb": "969cfa4b.f7a248",
        "name": "NearAir sqlite DB",
        "x": 1054,
        "y": 305,
        "wires": [
            [
                "5bb70018.60626"
            ]
        ]
    },
    {
        "id": "5bb70018.60626",
        "type": "function",
        "z": "50a8b9e3.df0248",
        "name": "NearAirFilter (get data[0])",
        "func": "var data = msg.payload;\nmsg.payload = data[0].text;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1262.5,
        "y": 421,
        "wires": [
            [
                "eaf297e5.86f768"
            ]
        ]
    },
    {
        "id": "eaf297e5.86f768",
        "type": "switch",
        "z": "50a8b9e3.df0248",
        "name": "Not Null (=SELECT)",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 1,
        "x": 1251.5,
        "y": 482,
        "wires": [
            [
                "dc355fae.20a4b"
            ]
        ]
    },
    {
        "id": "ba3b9c9b.1ef21",
        "type": "function",
        "z": "50a8b9e3.df0248",
        "name": "Set PIN",
        "func": "var pinObject = {\n    lat: msg.location.lat,\n    lon: msg.location.lon,\n    place: msg.location.place,\n    tweet: msg.payload,\n    name: msg.tweet.user.name,\n    icon: \"globe\",\n    iconColor: \"orange\"\n};\nvar payloadObject = { payload: pinObject };\nreturn payloadObject;",
        "outputs": 1,
        "noerr": 0,
        "x": 820,
        "y": 260,
        "wires": [
            [
                "8055c776.193948"
            ]
        ]
    },
    {
        "id": "4cf835ef.66817c",
        "type": "function",
        "z": "50a8b9e3.df0248",
        "name": "Move/Zoom",
        "func": "var commandObject = {\n        layer: \"OpenStreetMap Grayscale\",\n        lat: msg.location.lat,\n        log: msg.location.lon,\n        zoom: 3\n    };\nvar payloadObject = { command: commandObject };\nvar newMsg = { payload: payloadObject };\n\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "x": 830,
        "y": 220,
        "wires": [
            [
                "8055c776.193948"
            ]
        ]
    },
    {
        "id": "e96958b.d05c4a8",
        "type": "mqtt-broker",
        "z": "",
        "broker": "m14.cloudmqtt.com",
        "port": "19917",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "969cfa4b.f7a248",
        "type": "sqlitedb",
        "z": "",
        "db": "/Users/db/nearair.db"
    }
]